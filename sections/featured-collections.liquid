{%- comment -%}
  Featured Collections Section
  Rapha-inspired collection grid with editorial imagery
  - Section title with overline + serif headline
  - 2-3 collection cards (desktop), 2 (tablet), 1 (mobile)
  - Each card: 2:3 aspect ratio image, collection title below
  - Hover: subtle scale + opacity transition
{%- endcomment -%}

<section
  id="FeaturedCollections-{{ section.id }}"
  class="featured-collections bg-{{ section.settings.background_color }} py-12 md:py-16 lg:py-24"
>
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-[1280px]">
    {%- comment -%} Section Header {%- endcomment -%}
    {%- if section.settings.overline != blank or section.settings.heading != blank -%}
      <header class="mb-8 md:mb-12 lg:mb-16 {% if section.settings.text_alignment == 'center' %}text-center{% endif %}">
        {%- if section.settings.overline != blank -%}
          <p class="overline text-[11px] uppercase tracking-[0.15em] font-medium text-[#6B6B6B] mb-2 md:mb-3">
            {{ section.settings.overline }}
          </p>
        {%- endif -%}

        {%- if section.settings.heading != blank -%}
          <h2 class="font-display text-[#1A1A1A] text-[28px] sm:text-[32px] md:text-[36px] lg:text-[42px] leading-[1.2] font-normal">
            {{ section.settings.heading }}
          </h2>
        {%- endif -%}
      </header>
    {%- endif -%}

    {%- comment -%} Collection Grid {%- endcomment -%}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-{{ section.settings.columns_desktop }} gap-4 md:gap-6 lg:gap-8">
      {%- for block in section.blocks -%}
        {%- liquid
          assign collection = block.settings.collection
          assign custom_image = block.settings.custom_image
          assign custom_title = block.settings.custom_title
        -%}

        <article
          class="collection-card group"
          {{ block.shopify_attributes }}
        >
          <a
            href="{% if collection != blank %}{{ collection.url }}{% else %}#{% endif %}"
            class="block"
            {% if collection == blank %}aria-disabled="true"{% endif %}
          >
            {%- comment -%} Card Image {%- endcomment -%}
            <div class="relative aspect-[2/3] overflow-hidden bg-[#F7F7F5] mb-3 md:mb-4">
              {%- if custom_image != blank -%}
                {%- assign image = custom_image -%}
              {%- elsif collection != blank and collection.featured_image -%}
                {%- assign image = collection.featured_image -%}
              {%- else -%}
                {%- assign image = blank -%}
              {%- endif -%}

              {%- if image != blank -%}
                {%- assign image_height = image.width | divided_by: image.aspect_ratio -%}
                <img
                  srcset="
                    {%- if image.width >= 375 -%}{{ image | image_url: width: 375 }} 375w,{%- endif -%}
                    {%- if image.width >= 550 -%}{{ image | image_url: width: 550 }} 550w,{%- endif -%}
                    {%- if image.width >= 750 -%}{{ image | image_url: width: 750 }} 750w,{%- endif -%}
                    {%- if image.width >= 1000 -%}{{ image | image_url: width: 1000 }} 1000w,{%- endif -%}
                    {{ image | image_url }} {{ image.width }}w
                  "
                  src="{{ image | image_url: width: 750 }}"
                  sizes="(min-width: 1024px) 33vw, (min-width: 768px) 50vw, 100vw"
                  alt="{{ image.alt | escape | default: collection.title }}"
                  width="{{ image.width }}"
                  height="{{ image_height }}"
                  loading="lazy"
                  class="w-full h-full object-cover transition-transform duration-500 ease-out group-hover:scale-[1.02]"
                >
              {%- else -%}
                <div class="w-full h-full flex items-center justify-center">
                  {{ 'collection-1' | placeholder_svg_tag: 'w-full h-full text-[#E0DED9]' }}
                </div>
              {%- endif -%}
            </div>

            {%- comment -%} Card Title {%- endcomment -%}
            <h3 class="text-[12px] md:text-[13px] uppercase tracking-[0.15em] font-medium text-[#1A1A1A] transition-opacity duration-300 group-hover:opacity-70">
              {%- if custom_title != blank -%}
                {{ custom_title }}
              {%- elsif collection != blank -%}
                {{ collection.title }}
              {%- else -%}
                Collection Title
              {%- endif -%}
            </h3>
          </a>
        </article>
      {%- endfor -%}

      {%- comment -%} Placeholder blocks if none configured {%- endcomment -%}
      {%- if section.blocks.size == 0 -%}
        {%- for i in (1..3) -%}
          <article class="collection-card group">
            <a href="#" class="block" aria-disabled="true">
              <div class="relative aspect-[2/3] overflow-hidden bg-[#F7F7F5] mb-3 md:mb-4">
                <div class="w-full h-full flex items-center justify-center">
                  {{ 'collection-1' | placeholder_svg_tag: 'w-full h-full text-[#E0DED9]' }}
                </div>
              </div>
              <h3 class="text-[12px] md:text-[13px] uppercase tracking-[0.15em] font-medium text-[#1A1A1A]">
                Collection {{ forloop.index }}
              </h3>
            </a>
          </article>
        {%- endfor -%}
      {%- endif -%}
    </div>

    {%- comment -%} View All Link {%- endcomment -%}
    {%- if section.settings.show_view_all and section.settings.view_all_link != blank -%}
      <div class="mt-8 md:mt-12 lg:mt-16 {% if section.settings.text_alignment == 'center' %}text-center{% endif %}">
        <a
          href="{{ section.settings.view_all_link }}"
          class="inline-flex items-center text-[13px] uppercase tracking-[0.1em] text-[#1A1A1A] underline underline-offset-4 hover:opacity-70 transition-opacity duration-300"
        >
          {{ section.settings.view_all_text | default: 'View All Collections' }}
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Featured Collections",
  "tag": "section",
  "class": "featured-collections-section",
  "max_blocks": 4,
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "overline",
      "label": "Overline Text",
      "default": "Shop By Category"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Collections"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "columns_desktop",
      "label": "Columns (Desktop)",
      "options": [
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" }
      ],
      "default": "3"
    },
    {
      "type": "select",
      "id": "background_color",
      "label": "Background Color",
      "options": [
        { "value": "white", "label": "White" },
        { "value": "surface", "label": "Off-White" },
        { "value": "off-white", "label": "Warm Gray" }
      ],
      "default": "white"
    },
    {
      "type": "header",
      "content": "View All Link"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show View All Link",
      "default": false
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "View All Text",
      "default": "View All Collections"
    },
    {
      "type": "url",
      "id": "view_all_link",
      "label": "View All Link"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "custom_image",
          "label": "Custom Image",
          "info": "Optional. Overrides the collection's featured image."
        },
        {
          "type": "text",
          "id": "custom_title",
          "label": "Custom Title",
          "info": "Optional. Overrides the collection's title."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Collections",
      "blocks": [
        { "type": "collection" },
        { "type": "collection" },
        { "type": "collection" }
      ]
    }
  ]
}
{% endschema %}
