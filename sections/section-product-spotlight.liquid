{%- comment -%}
  SECTION: Product Spotlight
  Rapha-inspired split layout featuring a single product or collection.
  Image dominant left, content right. Mobile: stacked.
{%- endcomment -%}

{%- liquid
  assign product = section.settings.product
  assign layout = section.settings.layout
  assign bg_color = section.settings.background_color
-%}

<section
  id="ProductSpotlight-{{ section.id }}"
  class="product-spotlight product-spotlight--{{ layout }} product-spotlight--bg-{{ bg_color }}"
>
  <div class="product-spotlight__wrapper">
    {%- comment -%} Image Side {%- endcomment -%}
    <div class="product-spotlight__media">
      {%- if section.settings.image != blank -%}
        <img
          src="{{ section.settings.image | image_url: width: 1200 }}"
          srcset="
            {{ section.settings.image | image_url: width: 600 }} 600w,
            {{ section.settings.image | image_url: width: 900 }} 900w,
            {{ section.settings.image | image_url: width: 1200 }} 1200w,
            {{ section.settings.image | image_url: width: 1600 }} 1600w
          "
          sizes="(max-width: 1023px) 100vw, 55vw"
          alt="{{ section.settings.image.alt | default: section.settings.heading | escape }}"
          loading="lazy"
          width="{{ section.settings.image.width }}"
          height="{{ section.settings.image.height }}"
          class="product-spotlight__image"
        >
      {%- elsif product != blank and product.featured_image != blank -%}
        <img
          src="{{ product.featured_image | image_url: width: 1200 }}"
          srcset="
            {{ product.featured_image | image_url: width: 600 }} 600w,
            {{ product.featured_image | image_url: width: 900 }} 900w,
            {{ product.featured_image | image_url: width: 1200 }} 1200w,
            {{ product.featured_image | image_url: width: 1600 }} 1600w
          "
          sizes="(max-width: 1023px) 100vw, 55vw"
          alt="{{ product.featured_image.alt | default: product.title | escape }}"
          loading="lazy"
          width="{{ product.featured_image.width }}"
          height="{{ product.featured_image.height }}"
          class="product-spotlight__image"
        >
      {%- else -%}
        <div class="product-spotlight__placeholder">
          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
        </div>
      {%- endif -%}
    </div>

    {%- comment -%} Content Side {%- endcomment -%}
    <div class="product-spotlight__content">
      <div class="product-spotlight__content-inner">
        {%- if section.settings.overline != blank -%}
          <span class="product-spotlight__overline">{{ section.settings.overline }}</span>
        {%- endif -%}

        {%- if section.settings.heading != blank -%}
          <h2 class="product-spotlight__heading">{{ section.settings.heading }}</h2>
        {%- elsif product != blank -%}
          <h2 class="product-spotlight__heading">{{ product.title }}</h2>
        {%- endif -%}

        {%- if section.settings.description != blank -%}
          <div class="product-spotlight__description">
            {{ section.settings.description }}
          </div>
        {%- elsif product != blank and product.description != blank -%}
          <div class="product-spotlight__description">
            {{ product.description | strip_html | truncatewords: 40 }}
          </div>
        {%- endif -%}

        {%- if product != blank -%}
          <div class="product-spotlight__price">
            {%- if product.compare_at_price > product.price -%}
              <span class="product-spotlight__price-sale">{{ product.price | money }}</span>
              <span class="product-spotlight__price-compare">{{ product.compare_at_price | money }}</span>
            {%- else -%}
              <span class="product-spotlight__price-regular">{{ product.price | money }}</span>
            {%- endif -%}
          </div>
        {%- endif -%}

        {%- if section.settings.button_label != blank -%}
          <div class="product-spotlight__cta">
            {%- liquid
              if section.settings.button_link != blank
                assign btn_url = section.settings.button_link
              elsif product != blank
                assign btn_url = product.url
              else
                assign btn_url = '#'
              endif
            -%}
            <a href="{{ btn_url }}" class="product-spotlight__btn">
              {{ section.settings.button_label }}
            </a>
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</section>

<style>
  .product-spotlight {
    width: 100%;
  }

  .product-spotlight--bg-white {
    background-color: var(--color-white, #FFFFFF);
  }

  .product-spotlight--bg-off-white {
    background-color: var(--color-off-white, #F7F7F5);
  }

  .product-spotlight--bg-warm-gray {
    background-color: var(--color-warm-gray, #E8E6E1);
  }

  .product-spotlight__wrapper {
    display: flex;
    flex-direction: column;
  }

  .product-spotlight__media {
    position: relative;
    aspect-ratio: 4 / 3;
    overflow: hidden;
    background-color: var(--color-off-white, #F7F7F5);
  }

  .product-spotlight__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-spotlight__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-warm-gray, #E8E6E1);
  }

  .product-spotlight__placeholder svg {
    width: 30%;
    height: auto;
    opacity: 0.3;
  }

  .product-spotlight__content {
    padding: var(--space-2xl, 3rem) var(--space-md, 1rem);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .product-spotlight__content-inner {
    max-width: 480px;
    text-align: center;
  }

  .product-spotlight__overline {
    display: block;
    font-family: var(--font-body, 'DM Sans', sans-serif);
    font-size: 0.6875rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--color-text-secondary, #6B6B6B);
    margin-bottom: var(--space-sm, 0.5rem);
  }

  .product-spotlight__heading {
    font-family: var(--font-display, 'Instrument Serif', serif);
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 400;
    line-height: 1.2;
    color: var(--color-text-primary, #1A1A1A);
    margin: 0 0 var(--space-md, 1rem);
  }

  .product-spotlight__description {
    font-family: var(--font-body, 'DM Sans', sans-serif);
    font-size: 1rem;
    line-height: 1.65;
    color: var(--color-text-secondary, #6B6B6B);
    margin-bottom: var(--space-lg, 1.5rem);
  }

  .product-spotlight__price {
    font-family: var(--font-body, 'DM Sans', sans-serif);
    font-size: 1.125rem;
    margin-bottom: var(--space-lg, 1.5rem);
  }

  .product-spotlight__price-regular,
  .product-spotlight__price-sale {
    color: var(--color-text-primary, #1A1A1A);
    font-weight: 500;
  }

  .product-spotlight__price-sale {
    color: var(--color-error, #C23B22);
  }

  .product-spotlight__price-compare {
    color: var(--color-text-tertiary, #9B9B9B);
    text-decoration: line-through;
    margin-left: var(--space-sm, 0.5rem);
  }

  .product-spotlight__cta {
    margin-top: var(--space-lg, 1.5rem);
  }

  .product-spotlight__btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-body, 'DM Sans', sans-serif);
    font-size: 0.8125rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    text-decoration: none;
    padding: 1rem 2.5rem;
    background-color: var(--color-black, #0A0A0A);
    color: var(--color-white, #FFFFFF);
    transition: background-color 0.3s ease;
  }

  .product-spotlight__btn:hover {
    background-color: #333;
    opacity: 1;
  }

  /* Tablet and up: side by side */
  @media (min-width: 1024px) {
    .product-spotlight__wrapper {
      flex-direction: row;
      min-height: 600px;
    }

    .product-spotlight--image-right .product-spotlight__wrapper {
      flex-direction: row-reverse;
    }

    .product-spotlight__media {
      flex: 0 0 55%;
      aspect-ratio: auto;
    }

    .product-spotlight__content {
      flex: 0 0 45%;
      padding: var(--space-3xl, 4rem);
    }

    .product-spotlight__content-inner {
      text-align: left;
    }
  }

  /* Large desktop */
  @media (min-width: 1280px) {
    .product-spotlight__content {
      padding: var(--space-4xl, 6rem);
    }
  }
</style>

{% schema %}
{
  "name": "Product Spotlight",
  "tag": "section",
  "class": "section-product-spotlight",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product",
      "info": "Select a product to feature. Content below will override product data."
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Image position",
      "options": [
        { "value": "image-left", "label": "Image left" },
        { "value": "image-right", "label": "Image right" }
      ],
      "default": "image-left"
    },
    {
      "type": "select",
      "id": "background_color",
      "label": "Background color",
      "options": [
        { "value": "white", "label": "White" },
        { "value": "off-white", "label": "Off-white" },
        { "value": "warm-gray", "label": "Warm gray" }
      ],
      "default": "off-white"
    },
    {
      "type": "header",
      "content": "Image"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Custom image",
      "info": "Overrides the product image. Recommended: 1200x900px or larger."
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "overline",
      "label": "Overline",
      "info": "Small text above heading (e.g., 'Featured Product')"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "info": "Overrides the product title"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "info": "Overrides the product description"
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "Shop Now"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link",
      "info": "Leave blank to link to the selected product"
    }
  ],
  "presets": [
    {
      "name": "Product Spotlight",
      "settings": {
        "overline": "Featured Product",
        "button_label": "Shop Now"
      }
    }
  ]
}
{% endschema %}
